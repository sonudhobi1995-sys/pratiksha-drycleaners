<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pratiksha Billing | ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó</title>
    
    <link rel="manifest" href="manifest-billing.json">
    <meta name="theme-color" content="#FF8C00">
    <link rel="apple-touch-icon" href="logo.png">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sun-orange: #FF8C00;
            --saturn-blue: #001F3F;
            --jupiter-yellow: #FFF9C4;
        }

        body { font-family: 'Poppins', sans-serif; background: #f0f4f8; margin: 0; padding: 0; color: #333; }
        
        .billing-header { 
            background: var(--saturn-blue); 
            color: white; padding: 30px 20px; text-align: center; 
            border-radius: 0 0 30px 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .app-logo { width: 65px; height: 65px; background: white; border-radius: 50%; padding: 5px; border: 2px solid var(--sun-orange); object-fit: contain; margin-bottom: 10px; }

        .container { padding: 20px; max-width: 550px; margin: -20px auto 50px; }
        .card { background: white; padding: 22px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.02); }
        
        h3 { margin: 0 0 15px; color: var(--saturn-blue); border-bottom: 2px solid var(--sun-orange); display: inline-block; font-size: 1rem; }
        
        .input-group { display: flex; gap: 8px; margin: 10px 0; }
        .btn-contact { padding: 0 15px; border-radius: 15px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        input, select { width: 100%; padding: 14px; margin: 10px 0; border-radius: 15px; border: 1px solid #eee; box-sizing: border-box; font-size: 1rem; outline: none; background: #f9f9f9; }
        input:focus { border-color: var(--sun-orange); background: #fff; }
        
        .btn-add { background: var(--saturn-blue); color: white; width: 100%; border: none; padding: 16px; border-radius: 15px; cursor: pointer; font-weight: 700; transition: 0.3s; margin-top: 10px; }
        .btn-add:hover { background: var(--sun-orange); transform: translateY(-2px); }

        .total-box { background: var(--jupiter-yellow); padding: 20px; border-radius: 20px; text-align: center; border: 2px dashed var(--sun-orange); margin-top: 20px; }
        
        .btn-wa { background: #25D366; color: white; width: 100%; padding: 18px; border: none; border-radius: 20px; font-weight: 700; margin-top: 25px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.1rem; box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3); }
        .btn-print { background: #333; color: white; width: 100%; padding: 12px; border: none; border-radius: 15px; font-weight: 600; margin-top: 10px; cursor: pointer; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        td { padding: 15px 10px; border-bottom: 1px solid #f0f0f0; font-size: 0.95rem; }
        .item-name { font-weight: 600; color: var(--saturn-blue); }
        .item-price { text-align: right; font-weight: 700; color: var(--sun-orange); }

        @media print {
            .no-print { display: none !important; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; padding: 20px; visibility: visible; }
            .total-box { border: 2px solid #000; background: none !important; color: #000; }
            #navgrahTop { display: block !important; text-align: center; font-size: 12px; margin-bottom: 10px; border-bottom: 1px solid #000; padding-bottom: 5px; }
            #billShopTitle { display: block !important; text-align: center; }
            #printFooter { display: block !important; text-align: center; margin-top: 30px; font-weight: bold; }
        }
    </style>
</head>
<body>

<div class="billing-header no-print">
    <img src="logo.png" alt="PRATIKSHA" class="app-logo">
    <h1 style="margin:0; font-size: 1.5rem; letter-spacing: 1px;">PRATIKSHA DIGITAL</h1>
    <p style="margin:5px 0 0; font-size: 0.8rem; opacity: 0.8;">‡•§‡•§ ‡§∂‡•Å‡§ö‡§ø‡§§‡§æ ‡§î‡§∞ ‡§∞‡•Ç‡§π‡§æ‡§®‡•Ä ‡§∏‡•á‡§µ‡§æ ‡•§‡•§</p>
</div>

<div class="container">
    <div class="card no-print">
        <h3>üë§ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
        <div class="input-group">
            <input type="tel" id="custMobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
            <button type="button" class="btn-contact" onclick="getContact()">üë§</button>
        </div>
        <input type="text" id="custName" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ">
    </div>

    <div class="card no-print">
        <h3>üß∫ ‡§∏‡•á‡§µ‡§æ ‡§ï‡§æ ‡§ö‡§Ø‡§®</h3>
        <select id="itemSelect">
            <option value="">‡§ï‡§™‡§°‡§º‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</option>
            <option value="‡§∞‡•á‡§ó‡•Å‡§≤‡§∞ ‡§ï‡§™‡§°‡§º‡•á">üß• ‡§∞‡•á‡§ó‡•Å‡§≤‡§∞ ‡§ï‡§™‡§°‡§º‡•á</option>
            <option value="‡§∂‡§∞‡•ç‡§ü">‡§∂‡§∞‡•ç‡§ü</option>
            <option value="‡§™‡•á‡§Ç‡§ü/‡§ú‡•Ä‡§Ç‡§∏">‡§™‡•á‡§Ç‡§ü/‡§ú‡•Ä‡§Ç‡§∏</option>
            <option value="‡§∏‡§æ‡§°‡§º‡•Ä">‡§∏‡§æ‡§°‡§º‡•Ä</option>
            <option value="‡§∏‡•Ç‡§ü/‡§ï‡•Å‡§∞‡•ç‡§§‡§æ">‡§∏‡•Ç‡§ü/‡§ï‡•Å‡§∞‡•ç‡§§‡§æ</option>
            <option value="‡§ï‡§Ç‡§¨‡§≤/‡§ö‡§æ‡§¶‡§∞">‡§ï‡§Ç‡§¨‡§≤/‡§ö‡§æ‡§¶‡§∞</option>
            <option value="‡§Ö‡§®‡•ç‡§Ø">‡§Ö‡§®‡•ç‡§Ø</option>
        </select>
        <select id="serviceType">
            <option value="‡§™‡•ç‡§∞‡•á‡§∏">üí® ‡§™‡•ç‡§∞‡•á‡§∏</option>
            <option value="‡§∏‡•ç‡§ü‡•Ä‡§Æ ‡§™‡•ç‡§∞‡•á‡§∏">üí® ‡§∏‡•ç‡§ü‡•Ä‡§Æ ‡§™‡•ç‡§∞‡•á‡§∏</option>
            <option value="‡§ß‡•Å‡§≤‡§æ‡§à ‡§™‡•ç‡§∞‡•á‡§∏">üßº ‡§ß‡•Å‡§≤‡§æ‡§à ‡§™‡•ç‡§∞‡•á‡§∏</option>
            <option value="‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§ø‡§Ç‡§ó">‚ú® ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§ø‡§Ç‡§ó</option>
        </select>
        <div style="display:flex; gap:12px;">
            <input type="number" id="qty" placeholder="‡§®‡§ó">
            <input type="number" id="rate" placeholder="‡§∞‡•á‡§ü ‚Çπ">
        </div>
        <button class="btn-add" onclick="addItem()">+ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
    </div>

    <div class="card" id="printArea">
        <div id="navgrahTop" style="display:none;">
            ‚òÄÔ∏è ‡§∏‡•Ç‡§∞‡•ç‡§Ø üåô ‡§ö‡§Ç‡§¶‡•ç‡§∞ üî• ‡§Æ‡§Ç‡§ó‡§≤ üåø ‡§¨‡•Å‡§ß üåü ‡§ó‡•Å‡§∞‡•Å ‚ú® ‡§∂‡•Å‡§ï‡•ç‡§∞ ü™ê ‡§∂‡§®‡§ø üåë ‡§∞‡§æ‡§π‡•Å ‚òÑÔ∏è ‡§ï‡•á‡§§‡•Å
        </div>

        <div id="billShopTitle" style="display:none; text-align:center;">
            <h1 style="margin:0; font-size: 24px;">PRATIKSHA DRYCLEANERS</h1>
            <p style="margin:3px 0; font-size: 13px;">‡§Ö‡§Ç‡§¨‡§æ‡§¨‡§æ‡§°‡§º‡•Ä, ‡§ú‡§Ø‡§™‡•Å‡§∞ | ‡§Æ‡•ã: 8440985969</p>
            <p style="font-size: 11px;">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: <span id="pDate"></span></p>
            <hr style="border: 0.5px solid #000;">
        </div>

        <table id="billTable">
            <tbody></tbody>
        </table>

        <div class="total-box">
            <h2 id="gTotal" style="margin:0; font-size: 1.8rem;">Total: ‚Çπ 0</h2>
        </div>

        <div id="printFooter" style="display:none;">
            <hr style="border: 0.5px solid #000; margin-bottom:10px;">
            ‡•§‡•§ ‡§∂‡•Å‡§ö‡§ø‡§§‡§æ ‡§î‡§∞ ‡§∞‡•Ç‡§π‡§æ‡§®‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§π‡•Ä ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™ ‡§π‡•à ‡•§‡•§
        </div>
        
        <button class="btn-wa no-print" id="waBtn" onclick="sendWA()">üì≤ ‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§î‡§∞ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
        <button class="btn-print no-print" onclick="printBill()">üñ®Ô∏è ‡§∞‡§∏‡•Ä‡§¶ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
    </div>
</div>

<script>
    let billItems = [];
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx-Cu2CNgnLn6685hq40wxSW1AzK5fXJx91fDUGVEJvhvq8eDxRSZ7fhKDFrCCT2p8/exec";

    async function getContact() {
        if (!('contacts' in navigator)) return alert("‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§™‡§∞ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§");
        try {
            const props = ['name', 'tel'];
            const contacts = await navigator.contacts.select(props, {multiple: false});
            if (contacts.length > 0) {
                const contact = contacts[0];
                if (contact.tel) document.getElementById('custMobile').value = contact.tel[0].replace(/\D/g, '').slice(-10);
                if (contact.name) document.getElementById('custName').value = contact.name[0];
            }
        } catch (err) { console.log(err); }
    }

    function addItem() {
        const item = document.getElementById('itemSelect').value;
        const service = document.getElementById('serviceType').value;
        const q = document.getElementById('qty').value;
        const r = document.getElementById('rate').value;
        if(!item || !q || !r) return alert("‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§î‡§∞ ‡§∞‡•á‡§ü ‡§≠‡§∞‡•á‡§Ç");
        billItems.push({name: `${item} (${service})`, q, r, total: q*r});
        render();
        document.getElementById('qty').value = "";
    }

    function render() {
        const body = document.querySelector('#billTable tbody');
        body.innerHTML = ''; let grand = 0;
        billItems.forEach(i => {
            grand += i.total;
            body.innerHTML += `<tr><td class="item-name">${i.name} (${i.q} ‡§®‡§ó)</td><td class="item-price">‚Çπ${i.total}</td></tr>`;
        });
        document.getElementById('gTotal').innerText = `Total: ‚Çπ ${grand}`;
    }

    function printBill() {
        document.getElementById('pDate').innerText = new Date().toLocaleDateString('hi-IN');
        window.print();
    }

    function sendWA() {
        const mob = document.getElementById('custMobile').value;
        const name = document.getElementById('custName').value;
        const btn = document.getElementById('waBtn');
        if(!mob || mob.length < 10) return alert("‡§∏‡§π‡•Ä ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç");

        let grandTotal = 0;
        let itemDetails = "";
        
        // --- ‡§∞‡•Ç‡§π‡§æ‡§®‡•Ä ‡§î‡§∞ ‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§∏‡§Ç‡§¶‡•á‡§∂ ---
        let msg = `*‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§∞‡•ç‡§∏* ‚ú®üß∫\n`;
        msg += `_‡§∂‡•Å‡§ö‡§ø‡§§‡§æ ‡§î‡§∞ ‡§∞‡•Ç‡§π‡§æ‡§®‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ï‡§æ ‡§∏‡§Ç‡§ó‡§Æ_\n\n`;
        msg += `*üôè "‡§µ‡§∏‡•ç‡§§‡•ç‡§∞ ‡§ï‡•á‡§µ‡§≤ ‡§§‡§® ‡§®‡§π‡•Ä‡§Ç ‡§¢‡§ï‡§§‡•á, ‡§µ‡•á ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§ï‡§æ ‡§¶‡§∞‡•ç‡§™‡§£ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™‡§ï‡•Ä ‡§á‡§∏‡•Ä ‡§ó‡§∞‡§ø‡§Æ‡§æ ‡§ï‡•ã ‡§∂‡•Å‡§ö‡§ø‡§§‡§æ ‡§∏‡•á ‡§®‡§ø‡§ñ‡§æ‡§∞‡§®‡§æ ‡§π‡•Ä ‡§π‡§Æ‡§æ‡§∞‡§æ '‡§ã‡§£‡§æ‡§®‡•Å‡§¨‡§Ç‡§ß' ‡§π‡•à‡•§" üôè*\n\n`;
        msg += `*‡§ó‡•ç‡§∞‡§æ‡§π‡§ï:* ${name}\n`;
        msg += `--------------------------\n`;
        
        billItems.forEach(i => {
            msg += `‚Ä¢ ${i.name}: ${i.q} ‡§®‡§ó = *‚Çπ${i.total}*\n`;
            itemDetails += `${i.name} (${i.q}), `;
            grandTotal += i.total;
        });
        msg += `--------------------------\n`;
        msg += `*‡§ï‡•Å‡§≤ ‡§¶‡•á‡§Ø ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${grandTotal}*\n\n`;
        msg += `‡•§‡•§ ‡§∂‡•Å‡§ö‡§ø‡§§‡§æ ‡§î‡§∞ ‡§∞‡•Ç‡§π‡§æ‡§®‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§π‡•Ä ‡§π‡§Æ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§ï‡§≤‡•ç‡§™ ‡§π‡•à ‡•§‡•§\n`;
        msg += `_‡§Ö‡§Ç‡§¨‡§æ‡§¨‡§æ‡§°‡§º‡•Ä, ‡§ú‡§Ø‡§™‡•Å‡§∞ | 8440985969_`;

        btn.innerText = "‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à... ‚è≥";
        btn.disabled = true;

        const finalURL = `${SCRIPT_URL}?action=addBill&mobile=${mob}&name=${encodeURIComponent(name)}&amount=${grandTotal}&details=${encodeURIComponent(itemDetails)}&mode=Cash`;
        
        fetch(finalURL, { method: 'GET', mode: 'no-cors' });

        setTimeout(() => {
            window.open(`https://wa.me/91${mob}?text=${encodeURIComponent(msg)}`, '_blank');
            alert("‡§¨‡§ø‡§≤ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à! ‚úÖ");
            location.reload();
        }, 1500);
    }
</script>
</body>
</html>
