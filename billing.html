<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pratiksha Billing - Navgrah Edition</title>
    
    <link rel="manifest" href="manifest-billing.json">
    <meta name="theme-color" content="#FF8C00">
    <link rel="apple-touch-icon" href="logo.png">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sun-orange: #FF8C00;
            --saturn-blue: #001F3F;
            --moon-white: #FFFFFF;
            --jupiter-yellow: #FFF9C4;
        }

        body { font-family: 'Inter', sans-serif; background: var(--moon-white); margin: 0; padding: 0; }
        
        .billing-header { 
            background: var(--saturn-blue); 
            color: white; 
            padding: 20px; 
            text-align: center; 
            border-radius: 0 0 30px 30px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .app-logo { 
            width: 80px; 
            height: 80px; 
            background: white; 
            border-radius: 50%; 
            padding: 5px; 
            margin-bottom: 10px; 
            border: 3px solid var(--sun-orange);
            object-fit: contain;
        }

        .container { padding: 20px; max-width: 500px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #eee; }
        
        h3 { margin-top: 0; color: var(--saturn-blue); border-bottom: 2px solid var(--sun-orange); display: inline-block; }
        
        /* ‡§ï‡•â‡§®‡•ç‡§ü‡•à‡§ï‡•ç‡§ü ‡§¨‡§ü‡§® ‡§î‡§∞ ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡§æ ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ */
        .input-group { display: flex; gap: 8px; margin: 10px 0; }
        .input-group input { margin: 0; flex: 1; }
        .btn-contact { padding: 0 15px; border-radius: 12px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; transition: 0.3s; }
        .btn-contact:active { background: #f0f0f0; transform: scale(0.95); }

        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #ddd; box-sizing: border-box; font-size: 1rem; }
        
        .btn-add { background: var(--saturn-blue); color: white; width: 100%; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-add:active { transform: scale(0.98); }

        .total-box { background: var(--jupiter-yellow); padding: 15px; border-radius: 15px; text-align: center; border: 2px dashed var(--sun-orange); margin-top: 15px; }
        
        .btn-wa { background: #25D366; color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; margin-top: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.2); }
        .btn-print { background: #007BFF; color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; margin-top: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2); }

        table { width: 100%; margin-top: 15px; border-collapse: collapse; }
        th { background: #f4f4f4; padding: 10px; text-align: left; font-size: 0.8rem; }
        td { padding: 12px 10px; border-bottom: 1px solid #eee; font-size: 0.95rem; }
        small { color: #666; font-size: 0.8rem; } 

        @media print {
            body * { visibility: hidden; }
            #printArea, #printArea * { visibility: visible; }
            #printArea { position: absolute; left: 0; top: 0; width: 100%; background-color: #fdfdfd !important; padding: 30px; }
            .print-logo { display: block !important; width: 70px; height: 70px; margin: 0 auto 10px; border-radius: 50%; border: 2px solid #FF8C00; visibility: visible !important; }
            #printArea::before { content: "‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§∞‡•ç‡§∏ üß∫"; display: block; text-align: center; font-size: 26px; font-weight: bold; color: #FF4500 !important; }
            .no-print { display: none !important; }
        }
        .print-logo { display: none; }
    </style>
</head>
    
<body>

<div class="billing-header no-print">
    <img src="logo.png" alt="PRATIKSHA" class="app-logo">
    <h1 style="margin:0; font-size: 1.4rem;">‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó ‡§ê‡§™</h1>
    <p style="margin:5px 0 0; font-size: 0.8rem; opacity: 0.8;">‡§∂‡•Å‡§ö‡§ø‡§§‡§æ ‡§î‡§∞ ‡§∞‡•Ç‡§π‡§æ‡§®‡•Ä ‡§∏‡•á‡§µ‡§æ</p>
</div>

<div class="container">
    <div class="card no-print">
        <h3>üë§ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
        <label>‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç:</label>
        <div class="input-group">
            <input type="tel" id="custMobile" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç">
            <button type="button" class="btn-contact" onclick="getContact('custMobile', 'custName')" title="‡§ï‡•â‡§®‡•ç‡§ü‡•à‡§ï‡•ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç">üë§</button>
        </div>
        <input type="text" id="custName" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ">
    </div>

    <div class="card no-print">
        <h3>üß∫ ‡§¨‡§ø‡§≤ ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
        <select id="itemSelect">
            <option value="">‡§ï‡§™‡•ú‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</option>
            <optgroup label="‡§™‡•Å‡§∞‡•Å‡§∑/‡§Æ‡§π‡§ø‡§≤‡§æ">
                <option value="‡§∂‡§∞‡•ç‡§ü">‡§∂‡§∞‡•ç‡§ü</option>
                <option value="‡§™‡•á‡§Ç‡§ü/‡§ú‡•Ä‡§Ç‡§∏">‡§™‡•á‡§Ç‡§ü/‡§ú‡•Ä‡§Ç‡§∏</option>
                <option value="‡§∏‡§æ‡•ú‡•Ä">‡§∏‡§æ‡•ú‡•Ä</option>
                <option value="‡§∏‡•Ç‡§ü/‡§ï‡•Å‡§∞‡•ç‡§§‡§æ">‡§∏‡•Ç‡§ü/‡§ï‡•Å‡§∞‡•ç‡§§‡§æ</option>
                <option value="‡§∞‡•á‡§ó‡•Å‡§≤‡§∞ ‡§ï‡§™‡•ú‡•á">‡§∞‡•á‡§ó‡•Å‡§≤‡§∞ ‡§ï‡§™‡•ú‡•á</option>
            </optgroup>
            <optgroup label="‡§µ‡§ø‡§Ç‡§ü‡§∞ (Garm)">
                <option value="‡§ú‡•à‡§ï‡•á‡§ü/‡§ï‡•ã‡§ü">‡§ú‡•à‡§ï‡•á‡§ü/‡§ï‡•ã‡§ü</option>
                <option value="‡§∏‡•ç‡§µ‡•á‡§ü‡§∞">‡§∏‡•ç‡§µ‡•á‡§ü‡§∞</option>
                <option value="‡§∂‡•â‡§≤/‡§ï‡§æ‡§∞‡•ç‡§°‡§ø‡§ó‡§®">‡§∂‡•â‡§≤/‡§ï‡§æ‡§∞‡•ç‡§°‡§ø‡§ó‡§®</option>
            </optgroup>
            <optgroup label="‡§ò‡§∞ (Home)">
                <option value="‡§ö‡§æ‡§¶‡§∞ (Bedsheet)">‡§ö‡§æ‡§¶‡§∞</option>
                <option value="‡§™‡§ø‡§≤‡•ã ‡§ï‡§µ‡§∞">‡§™‡§ø‡§≤‡•ã ‡§ï‡§µ‡§∞</option>
                <option value="‡§∞‡•Å‡§Æ‡§æ‡§≤/‡§®‡•à‡§™‡§ï‡§ø‡§®">‡§∞‡•Å‡§Æ‡§æ‡§≤/‡§®‡•à‡§™‡§ï‡§ø‡§®</option>
                <option value="‡§ï‡§Ç‡§¨‡§≤ (Blanket)">‡§ï‡§Ç‡§¨‡§≤</option>
            </optgroup>
            <option value="‡§Ö‡§®‡•ç‡§Ø (Other)">‡§Ö‡§®‡•ç‡§Ø</option>
        </select>

        <select id="serviceType">
            <option value="‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®">‚ú® ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®</option>
            <option value="‡§∏‡•ç‡§ü‡•Ä‡§Æ ‡§™‡•ç‡§∞‡•á‡§∏">üí® ‡§∏‡•ç‡§ü‡•Ä‡§Æ ‡§™‡•ç‡§∞‡•á‡§∏</option>
            <option value="‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§™‡•ç‡§∞‡•á‡§∏">üëî ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§™‡•ç‡§∞‡•á‡§∏</option>
            <option value="‡§ß‡•Å‡§≤‡§æ‡§à">üßº ‡§ß‡•Å‡§≤‡§æ‡§à</option>
        </select>

        <div style="display:flex; gap:10px;">
            <input type="number" id="qty" placeholder="‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ">
            <input type="number" id="rate" placeholder="‡§∞‡•á‡§ü (‚Çπ)">
        </div>
        <button class="btn-add" onclick="addItem()">+ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
    </div>

    <div class="card" id="printArea">
        <img src="logo.png" class="print-logo" alt="PRATIKSHA LOGO">
        <h3 class="no-print">üìã ‡§ï‡§ö‡•ç‡§ö‡§æ ‡§¨‡§ø‡§≤</h3>
        <table id="billTable">
            <thead><tr><th>‡§Ü‡§á‡§ü‡§Æ</th><th>‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ</th><th>‡§ï‡•Å‡§≤</th></tr></thead>
            <tbody></tbody>
        </table>
        <div class="total-box">
            <h2 id="gTotal" style="margin:0;">Total: ‚Çπ 0</h2>
        </div>
        
        <button class="btn-wa no-print" onclick="sendWA()">üì≤ ‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§™‡§∞ ‡§¨‡§ø‡§≤ ‡§≠‡•á‡§ú‡•á‡§Ç</button>
        <button class="btn-print no-print" onclick="window.print()">üìÑ ‡§™‡§∞‡•ç‡§ö‡•Ä ‡§®‡§ø‡§ï‡§æ‡§≤‡•á‡§Ç (PDF)</button>
    </div>
</div>

<script>
    let billItems = [];

    // --- ‡§ï‡•â‡§®‡•ç‡§ü‡•à‡§ï‡•ç‡§ü ‡§™‡§ø‡§ï‡§∞ ‡§ú‡§æ‡§¶‡•Å‡§à ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® (‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è) ---
    async function getContact(mobileId, nameId) {
        if (!('contacts' in navigator && 'ContactsManager' in window)) {
            return alert("‡§Ø‡§π ‡§´‡•Ä‡§ö‡§∞ ‡§ï‡•á‡§µ‡§≤ Android Chrome ‡§î‡§∞ HTTPS ‡§≤‡§ø‡§Ç‡§ï ‡§™‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§");
        }
        try {
            const props = ['name', 'tel'];
            const contacts = await navigator.contacts.select(props, {multiple: false});
            if (contacts.length > 0) {
                const contact = contacts[0];
                if (contact.tel && contact.tel.length > 0) {
                    let rawNum = contact.tel[0].replace(/\D/g, '');
                    document.getElementById(mobileId).value = rawNum.length > 10 ? rawNum.slice(-10) : rawNum;
                }
                if (contact.name && contact.name.length > 0) {
                    document.getElementById(nameId).value = contact.name[0];
                }
            }
        } catch (err) {
            console.log("Error: " + err.message);
        }
    }

    function addItem() {
        const name = document.getElementById('itemSelect').value;
        const service = document.getElementById('serviceType').value;
        const q = document.getElementById('qty').value;
        const r = document.getElementById('rate').value;
        if(!name || !q || !r) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");
        const total = q * r;
        billItems.push({name, service, q, r, total});
        render();
        document.getElementById('qty').value = "";
        document.getElementById('rate').value = "";
    }

    function render() {
        const body = document.querySelector('#billTable tbody');
        body.innerHTML = '';
        let grand = 0;
        billItems.forEach(i => {
            grand += i.total;
            body.innerHTML += `<tr><td>${i.name}<br><small>(${i.service})</small></td><td>${i.q}</td><td>‚Çπ${i.total}</td></tr>`;
        });
        document.getElementById('gTotal').innerText = `Total: ‚Çπ ${grand}`;
    }

    function sendWA() {
        const cName = document.getElementById('custName').value || "‡§ó‡•ç‡§∞‡§æ‡§π‡§ï";
        const mob = document.getElementById('custMobile').value;
        if(!mob || mob.length < 10) return alert("‡§∏‡§π‡•Ä ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç");
        let msg = `*‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§∞‡•ç‡§∏* üß∫‚ú®\n\n*‡§®‡§Æ‡§∏‡•ç‡§§‡•á ${cName},*\n‡§Ü‡§™‡§ï‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§¨‡§ø‡§≤ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à:\n\n`;
        let grandTotal = 0;
        billItems.forEach(i => {
            msg += `‚Ä¢ ${i.name} (${i.service})\n  ${i.q} x ${i.r} = *‚Çπ${i.total}*\n\n`;
            grandTotal += i.total;
        });
        msg += `----------------------\n*‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${grandTotal}*\n----------------------\n\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè‚ú®`;
        window.open(`https://wa.me/91${mob}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    // PWA ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§®
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sww.js');
    }
</script>
</body>
</html>
