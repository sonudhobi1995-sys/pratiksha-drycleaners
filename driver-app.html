<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver App | PRATIKSHA</title>
    <style>
        :root { --sun: #FF8C00; --dark: #001F3F; --green: #2E8B57; --bg: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-bottom: 70px; }
        .app-header { background: var(--dark); color: white; padding: 15px; text-align: center; border-radius: 0 0 20px 20px; }
        .app-logo { width: 70px; height: 70px; border-radius: 50%; background: white; padding: 5px; margin-bottom: 8px; border: 2px solid var(--sun); object-fit: contain; }
        .container { padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* рдХреЙрдиреНрдЯреИрдХреНрдЯ рдмрдЯрди рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рдЧреНрд░реБрдк */
        .input-group { display: flex; gap: 8px; margin: 10px 0; }
        .input-group input { margin: 0; flex: 1; }
        .btn-contact { padding: 0 15px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; }

        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 1rem; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: var(--sun); color: white; }
        .btn-success { background: var(--green); color: white; }
        
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #eee; }
        .nav-item { border: none; background: none; color: #888; font-size: 0.8rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--sun); font-weight: bold; }
        
        .cat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px; }
        .cat-btn { background: #f0f0f0; border: 1px solid #ddd; padding: 12px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; }
        .cat-btn.active { background: var(--dark); color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="app-header">
        <img src="logo.png" alt="PRATIKSHA" class="app-logo">
        <h2 style="margin:0; font-size: 1.2rem;">рдкреНрд░рддреАрдХреНрд╖рд╛ рдбреНрд░рд╛рдЗрд╡рд░ рдРрдк</h2>
    </div>

    <div class="container">
        <div id="pickup-sec" class="app-sec">
            <div class="card">
                <h3>ЁЯз║ рдирдпрд╛ рдкрд┐рдХрдЕрдк</h3>
                
                <div class="input-group">
                    <input type="tel" id="pickMobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ (10 рдЕрдВрдХ)">
                    <button type="button" class="btn-contact" onclick="getContact('pickMobile')">ЁЯСд</button>
                </div>
                
                <div class="cat-grid">
                    <button class="cat-btn" onclick="loadItems('men', this)">MEN</button>
                    <button class="cat-btn" onclick="loadItems('women', this)">WOMEN</button>
                    <button class="cat-btn" onclick="loadItems('winter', this)">WINTER</button>
                    <button class="cat-btn" onclick="loadItems('home', this)">HOME</button>
                </div>

                <select id="itemSelect"><option value="">рдХреИрдЯреЗрдЧрд░реА рдЪреБрдиреЗрдВ</option></select>
                
                <select id="serviceType">
                    <option value="рдкреНрд░реЗрд╕">ЁЯТи рдкреНрд░реЗрд╕</option>
                    <option value="рд╕реНрдЯреАрдо рдкреНрд░реЗрд╕">ЁЯТи рд╕реНрдЯреАрдо рдкреНрд░реЗрд╕</option>
                    <option value="рдзреБрд▓рд╛рдИ рдкреНрд░реЗрд╕">ЁЯз╝ рдзреБрд▓рд╛рдИ рдкреНрд░реЗрд╕</option>
                    <option value="рдбреНрд░рд╛рдИ рдХреНрд▓реАрдирд┐рдВрдЧ">тЬи рдбреНрд░рд╛рдИ рдХреНрд▓реАрдирд┐рдВрдЧ</option>
                </select>

                <div style="display:flex; gap:10px;">
                    <input type="number" id="itemQty" placeholder="рд╕рдВрдЦреНрдпрд╛" style="flex:1;">
                    <select id="itemNote" style="flex:1;">
                        <option value="OK">OK</option>
                        <option value="рджрд╛рдЧ">рджрд╛рдЧ</option>
                        <option value="рдХрдЯрд╛">рдХрдЯрд╛</option>
                    </select>
                </div>

                <button onclick="addToInv()" style="background:#eee; border:1px solid #ccc; width:100%; padding:10px; border-radius:8px;">+ рд▓рд┐рд╕реНрдЯ рдореЗрдВ рдЬреЛреЬреЗрдВ</button>
                <div id="liveList" style="margin-top:15px; font-size:0.85rem; color:#555; background:#fffde7; padding:10px; border-radius:8px; border: 1px dashed #ccc;"><b>рд▓рд┐рд╕реНрдЯ:</b></div>
                <button class="btn btn-primary" style="margin-top:15px;" id="pickBtn" onclick="submitPickup()">рдкрд┐рдХрдЕрдк рдХрдиреНрдлрд░реНрдо рдХрд░реЗрдВ</button>
            </div>
        </div>

        <div id="delivery-sec" class="app-sec hidden">
            <div class="card">
                <h3>ЁЯЪЪ рдбрд┐рд▓реАрд╡рд░реА рдФрд░ рдкреЗрдореЗрдВрдЯ</h3>
                <div class="input-group">
                    <input type="tel" id="delMobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░">
                    <button type="button" class="btn-contact" onclick="getContact('delMobile')">ЁЯСд</button>
                </div>
                <input type="number" id="amount" placeholder="рдХреБрд▓ рд░рд╛рд╢рд┐ (тВ╣)">
                <button class="btn btn-success" id="delBtn" onclick="confirmDelivery()">рдбрд┐рд▓реАрд╡рд░реА рдкреВрд░реНрдг рдХрд░реЗрдВ</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showSec('pickup-sec', this)">ЁЯз║<span>рдкрд┐рдХрдЕрдк</span></div>
        <div class="nav-item" onclick="showSec('delivery-sec', this)">ЁЯЪЪ<span>рдбрд┐рд▓реАрд╡рд░реА</span></div>
    </div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbz1jvpgkduKi7HLUyt58iBHxUcbjtNg6I4qtqFV7y3MBemDzifY4sx5JmTckLVLwBAfBA/exec';
    let selectedItems = [];

    // --- рдХреЙрдиреНрдЯреИрдХреНрдЯ рдЪреБрдирдиреЗ рдХреА рд╢рдХреНрддрд┐ ---
    async function getContact(mobileId) {
        if (!('contacts' in navigator)) return alert("Android Chrome рдкрд░ рд╣реА рдХрд╛рдо рдХрд░реЗрдЧрд╛ред");
        try {
            const props = ['tel'];
            const contacts = await navigator.contacts.select(props, {multiple: false});
            if (contacts.length > 0) {
                let rawNum = contacts[0].tel[0].replace(/\D/g, '');
                document.getElementById(mobileId).value = rawNum.slice(-10);
            }
        } catch (err) { console.log(err); }
    }

    function showSec(id, btn) {
        document.querySelectorAll('.app-sec').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
    }

    const inventory = {
        men: ["рд╢рд░реНрдЯ", "рдкреЗрдВрдЯ", "рдЬреАрдВрд╕", "рдЯреА-рд╢рд░реНрдЯ", "рд╕реВрдЯ", "рдХреЛрдЯ", "рдХреБрд░реНрддрд╛-рдкрд╛рдпрдЬрд╛рдорд╛", "рд╕рджрд░реА", "рд░реЗрдЧреБрд▓рд░ рдХрдкрдбрд╝реЗ", "рдЕрдиреНрдп (Other)"],
        women: ["рд╕рд╛реЬреА", "рд╕реВрдЯ-рд╕рд▓рд╡рд╛рд░", "рдХреБрд░реНрддреА", "рд▓рд╣рдВрдЧрд╛", "рджреБрдкрдЯреНрдЯрд╛", "рдЧрд╛рдЙрди", "рдмреНрд▓рд╛рдЙрдЬ", "рд░реЗрдЧреБрд▓рд░ рдХрдкрдбрд╝реЗ", "рдЕрдиреНрдп (Other)"],
        winter: ["рдЬреИрдХреЗрдЯ", "рднрд╛рд░реА рдХреЛрдЯ", "рд╕реНрд╡реЗрдЯрд░", "рдХрд╛рд░реНрдбрд┐рдЧрди", "рд╢реЙрд▓", "рдмреНрд▓реЗрдЬрд░", "рд░реЗрдЧреБрд▓рд░ рдХрдкрдбрд╝реЗ", "рдЕрдиреНрдп (Other)"],
        home: ["рдЪрд╛рджрд░", "рдХрдВрдмрд▓", "рдкрд░реНрджреЗ", "рддреМрд▓рд┐рдпрд╛", "рдЧрд▓реАрдЪрд╛", "рдкрд┐рд▓реЛ рдХрд╡рд░", "рд░реЗрдЧреБрд▓рд░ рдХрдкрдбрд╝реЗ", "рдЕрдиреНрдп (Other)"]
    };

    function loadItems(cat, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const sel = document.getElementById('itemSelect');
        sel.innerHTML = '';
        inventory[cat].forEach(i => { sel.innerHTML += `<option value="${i}">${i}</option>`; });
    }

    function addToInv() {
        const item = document.getElementById('itemSelect').value;
        const qty = document.getElementById('itemQty').value;
        const note = document.getElementById('itemNote').value;
        const service = document.getElementById('serviceType').value;
        if(!item || !qty) return alert("рд╕рдВрдЦреНрдпрд╛ рднрд░реЗрдВ");
        const entry = `${item}(${qty} рдирдЧ)-${service}[${note}]`;
        selectedItems.push(entry);
        document.getElementById('liveList').innerHTML += `<div>тАв ${entry}</div>`;
        document.getElementById('itemQty').value = "";
    }

    function submitPickup() {
        const mobile = document.getElementById('pickMobile').value;
        const dbStr = selectedItems.join(", ");
        if(!mobile || selectedItems.length === 0) return alert("рд╡рд┐рд╡рд░рдг рднрд░реЗрдВ");

        const btn = document.getElementById('pickBtn');
        btn.innerText = "рд╕реЗрд╡ рд╣реЛ рд░рд╣рд╛ рд╣реИ...";
        btn.disabled = true;
        
        // рдбреЗрдЯрд╛ рд╕реАрдзрд╛ рджрд╛рдЧрд╛ (No Alert)
        fetch(`${scriptURL}?action=updateStatus&mobile=${mobile}&status=рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ&details=${encodeURIComponent(dbStr)}`, { mode: 'no-cors' });

        setTimeout(() => {
            const waMsg = `*рдкреНрд░рддреАрдХреНрд╖рд╛ рдбреНрд░рд╛рдИ рдХреНрд▓реАрдирд░реНрд╕* ЁЯз║тЬи\n\nрдкрд┐рдХрдЕрдк рд╡рд┐рд╡рд░рдг: ${dbStr}\n\nрдзрдиреНрдпрд╡рд╛рдж! ЁЯЩП`;
            window.open(`https://wa.me/91${mobile}?text=${encodeURIComponent(waMsg)}`, '_blank');
            location.reload();
        }, 1200);
    }

    function confirmDelivery() {
        const mobile = document.getElementById('delMobile').value;
        const amt = document.getElementById('amount').value;
        if(!mobile || !amt) return alert("рдЕрдорд╛рдЙрдВрдЯ рднрд░реЗрдВ");

        const btn = document.getElementById('delBtn');
        btn.innerText = "рдЕрдкрдбреЗрдЯ рд╣реЛ рд░рд╣рд╛ рд╣реИ...";
        btn.disabled = true;
        
        fetch(`${scriptURL}?action=updateStatus&mobile=${mobile}&status=Delivered&amount=${amt}`, { mode: 'no-cors' });

        setTimeout(() => {
            location.reload();
        }, 1200);
    }
</script>
</body>
</html>
