<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver App | PRATIKSHA</title>
    <link rel="manifest" href="manifest-driver.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --sun: #FF8C00; --dark: #001F3F; --green: #2E8B57; --bg: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-bottom: 70px; }
        .app-header { background: var(--dark); color: white; padding: 15px; text-align: center; border-radius: 0 0 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .app-logo { width: 70px; height: 70px; border-radius: 50%; background: white; padding: 5px; margin-bottom: 8px; border: 2px solid var(--sun); object-fit: contain; }
        .container { padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 1rem; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--sun); color: white; }
        .btn-success { background: var(--green); color: white; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); border-top: 1px solid #eee; }
        .nav-item { border: none; background: none; color: #888; font-size: 0.8rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--sun); font-weight: bold; }
        .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 10px; }
        .cat-btn { background: #f0f0f0; border: 1px solid #ddd; padding: 10px; border-radius: 8px; font-size: 0.75rem; font-weight: bold; cursor: pointer; }
        .cat-btn.active { background: var(--dark); color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="app-header">
        <img src="logo.png" alt="PRATIKSHA" class="app-logo">
        <h2 style="margin:0; font-size: 1.2rem;">‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§ê‡§™</h2>
    </div>

    <div class="container">
        <div id="pickup-sec" class="app-sec">
            <div class="card">
                <h3>üß∫ ‡§®‡§Ø‡§æ ‡§™‡§ø‡§ï‡§Ö‡§™</h3>
                <input type="tel" id="pickMobile" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
                <div class="cat-grid">
                    <button class="cat-btn" onclick="loadItems('men', this)">MEN</button>
                    <button class="cat-btn" onclick="loadItems('women', this)">WOMEN</button>
                    <button class="cat-btn" onclick="loadItems('home', this)">HOME</button>
                </div>
                <select id="itemSelect"><option value="">‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</option></select>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="itemQty" placeholder="‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ" style="flex:1;">
                    <select id="itemNote" style="flex:1;">
                        <option value="OK">OK</option>
                        <option value="‡§¶‡§æ‡§ó">‡§¶‡§æ‡§ó</option>
                        <option value="‡§ï‡§ü‡§æ">‡§ï‡§ü‡§æ</option>
                    </select>
                </div>
                <button onclick="addToInv()" style="background:#eee; border:1px solid #ccc; width:100%; padding:10px; border-radius:8px; cursor:pointer;">+ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
                <div id="liveList" style="margin-top:15px; font-size:0.85rem; color:#555; background:#fffde7; padding:10px; border-radius:8px;"><b>‡§≤‡§ø‡§∏‡•ç‡§ü:</b></div>
                <button class="btn btn-primary" style="margin-top:15px;" onclick="submitPickup()">‡§™‡§ø‡§ï‡§Ö‡§™ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>

        <div id="delivery-sec" class="app-sec hidden">
            <div class="card">
                <h3>üöö ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§î‡§∞ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü</h3>
                <input type="tel" id="delMobile" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
                <label>‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏:</label>
                <select id="payStatus">
                    <option value="Paid">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ (Paid)</option>
                    <option value="Pending">‡§¨‡§æ‡§ï‡•Ä ‡§π‡•à (Pending)</option>
                </select>
                <input type="number" id="amount" placeholder="‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø (‚Çπ)">
                <button class="btn btn-success" onclick="confirmDelivery()">‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showSec('pickup-sec', this)">üß∫<span>‡§™‡§ø‡§ï‡§Ö‡§™</span></div>
        <div class="nav-item" onclick="showSec('delivery-sec', this)">üöö<span>‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä</span></div>
    </div>

<script>
    // ‡§Ü‡§™‡§ï‡§æ ‡§®‡§Ø‡§æ ‡§î‡§∞ ‡§´‡§æ‡§á‡§®‡§≤ scriptURL
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwdK-HX317pyyB_RPZDTGUDUCGeW8Qag0vzGIovfTUOUrq26gJYujOgGB-CF5ZXImCz/exec';
    let selectedItems = [];

    function showSec(id, btn) {
        document.querySelectorAll('.app-sec').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
    }

    const inventory = {
        men: ["‡§∂‡§∞‡•ç‡§ü", "‡§™‡•á‡§Ç‡§ü", "‡§∏‡•Ç‡§ü", "‡§ï‡•Å‡§∞‡•ç‡§§‡§æ-‡§™‡§æ‡§Ø‡§ú‡§æ‡§Æ‡§æ"],
        women: ["‡§∏‡§æ‡•ú‡•Ä", "‡§∏‡•Ç‡§ü-‡§∏‡§≤‡§µ‡§æ‡§∞", "‡§ï‡•Å‡§∞‡•ç‡§§‡•Ä", "‡§≤‡§π‡§Ç‡§ó‡§æ"],
        home: ["‡§¨‡•á‡§°‡§∂‡•Ä‡§ü", "‡§™‡§∞‡•ç‡§¶‡•á", "‡§ï‡§Ç‡§¨‡§≤", "‡§ß‡•ã‡§§‡•Ä"]
    };

    function loadItems(cat, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const sel = document.getElementById('itemSelect');
        sel.innerHTML = '';
        inventory[cat].forEach(i => { sel.innerHTML += `<option value="${cat.toUpperCase()}: ${i}">${i}</option>`; });
    }

    function addToInv() {
        const item = document.getElementById('itemSelect').value;
        const qty = document.getElementById('itemQty').value;
        const note = document.getElementById('itemNote').value;
        if(!item || !qty) return alert("‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");
        const entry = `${item} [${qty}] (${note})`;
        selectedItems.push(entry);
        document.getElementById('liveList').innerHTML += `<div>‚Ä¢ ${entry}</div>`;
        document.getElementById('itemQty').value = "";
    }

    function submitPickup() {
        const mobile = document.getElementById('pickMobile').value;
        const dbStr = selectedItems.join(", ");
        if(!mobile || selectedItems.length === 0) return alert("‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç");

        const btn = document.querySelector('button[onclick="submitPickup()"]');
        btn.innerText = "‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
        btn.disabled = true;

        // Fetch ‡§ï‡•á ‡§∏‡§æ‡§• response handling
        fetch(`${scriptURL}?action=updatePickup&mobile=${mobile}&details=${encodeURIComponent(dbStr)}`)
        .then(response => response.text())
        .then(data => {
            if(data === "Success") {
                alert("‡§™‡§ø‡§ï‡§Ö‡§™ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§! ‚úÖ");
                const waMsg = `*‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§∞‡•ç‡§∏* üß∫‚ú®\n\n‡§®‡§Æ‡§∏‡•ç‡§§‡•á,\n‡§Ü‡§™‡§ï‡§æ ‡§™‡§ø‡§ï‡§Ö‡§™ ‡§∏‡§´‡§≤ ‡§∞‡§π‡§æ‡•§\n\n*‡§µ‡§ø‡§µ‡§∞‡§£:* ${dbStr}\n\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;
                window.open(`https://wa.me/91${mobile}?text=${encodeURIComponent(waMsg)}`, '_blank');
                location.reload();
            } else {
                alert("‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§ï‡•ã‡§à ‡§ú‡§µ‡§æ‡§¨ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§");
                btn.innerText = "‡§™‡§ø‡§ï‡§Ö‡§™ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç";
                btn.disabled = false;
            }
        })
        .catch(error => {
            alert("‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§è‡§∞‡§∞! ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§");
            btn.innerText = "‡§™‡§ø‡§ï‡§Ö‡§™ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç";
            btn.disabled = false;
        });
    }

    function confirmDelivery() {
        const mobile = document.getElementById('delMobile').value;
        const amt = document.getElementById('amount').value;
        const status = document.getElementById('payStatus').value;
        if(!mobile || !amt) return alert("‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");

        const btn = document.querySelector('button[onclick="confirmDelivery()"]');
        btn.innerText = "‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
        btn.disabled = true;

        fetch(`${scriptURL}?action=updateStatus&mobile=${mobile}&status=Delivered&amount=${amt}`)
        .then(response => response.text())
        .then(data => {
            if(data === "Success") {
                alert("‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§∏‡§´‡§≤! ‚úÖ");
                location.reload();
            } else {
                alert("‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤‡•§");
                btn.innerText = "‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•á‡§Ç";
                btn.disabled = false;
            }
        })
        .catch(() => {
            alert("‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡•§");
            btn.innerText = "‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•á‡§Ç";
            btn.disabled = false;
        });
    }
</script>
</body>
</html>
