<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver App | PRATIKSHA</title>
    <link rel="manifest" href="manifest-driver.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --sun: #FF8C00; --dark: #001F3F; --green: #2E8B57; --bg: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-bottom: 70px; }
        .app-header { background: var(--dark); color: white; padding: 15px; text-align: center; border-radius: 0 0 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .app-logo { width: 70px; height: 70px; border-radius: 50%; background: white; padding: 5px; margin-bottom: 8px; border: 2px solid var(--sun); object-fit: contain; }
        .container { padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .input-group { display: flex; gap: 8px; margin: 10px 0; }
        .input-group input { margin: 0; flex: 1; }
        .btn-contact { padding: 0 15px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-size: 1.2rem; transition: 0.3s; display: flex; align-items: center; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 1rem; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--sun); color: white; }
        .btn-success { background: var(--green); color: white; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); border-top: 1px solid #eee; }
        .nav-item { border: none; background: none; color: #888; font-size: 0.8rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--sun); font-weight: bold; }
        .cat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
        .cat-btn { background: #f0f0f0; border: 1px solid #ddd; padding: 10px; border-radius: 8px; font-size: 0.75rem; font-weight: bold; cursor: pointer; }
        .cat-btn.active { background: var(--dark); color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="app-header">
        <img src="logo.png" alt="PRATIKSHA" class="app-logo">
        <h2 style="margin:0; font-size: 1.2rem;">‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§ê‡§™</h2>
    </div>

    <div class="container">
        <div id="pickup-sec" class="app-sec">
            <div class="card">
                <h3>üß∫ ‡§®‡§Ø‡§æ ‡§™‡§ø‡§ï‡§Ö‡§™</h3>
                <div class="input-group">
                    <input type="tel" id="pickMobile" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
                    <button type="button" class="btn-contact" onclick="getContact('pickMobile')">üë§</button>
                </div>
                
                <div class="cat-grid">
                    <button class="cat-btn" onclick="loadItems('men', this)">MEN</button>
                    <button class="cat-btn" onclick="loadItems('women', this)">WOMEN</button>
                    <button class="cat-btn" onclick="loadItems('winter', this)">WINTER</button>
                    <button class="cat-btn" onclick="loadItems('home', this)">HOME</button>
                </div>

                <select id="itemSelect"><option value="">‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç</option></select>

                <select id="serviceType">
                    <option value="‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®">‚ú® ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®</option>
                    <option value="‡§∏‡•ç‡§ü‡•Ä‡§Æ ‡§™‡•ç‡§∞‡•á‡§∏">üí® ‡§∏‡•ç‡§ü‡•Ä‡§Æ ‡§™‡•ç‡§∞‡•á‡§∏</option>
                    <option value="‡§ß‡•Å‡§≤‡§æ‡§à">üßº ‡§ß‡•Å‡§≤‡§æ‡§à</option>
                </select>

                <div style="display:flex; gap:10px;">
                    <input type="number" id="itemQty" placeholder="‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ" style="flex:1;">
                    <select id="itemNote" style="flex:1;">
                        <option value="OK">OK</option>
                        <option value="‡§¶‡§æ‡§ó">‡§¶‡§æ‡§ó</option>
                        <option value="‡§ï‡§ü‡§æ">‡§ï‡§ü‡§æ</option>
                    </select>
                </div>

                <button onclick="addToInv()" style="background:#eee; border:1px solid #ccc; width:100%; padding:10px; border-radius:8px;">+ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
                <div id="liveList" style="margin-top:15px; font-size:0.85rem; color:#555; background:#fffde7; padding:10px; border-radius:8px;"><b>‡§≤‡§ø‡§∏‡•ç‡§ü:</b></div>
                <button class="btn btn-primary" style="margin-top:15px;" id="pickBtn" onclick="submitPickup()">‡§™‡§ø‡§ï‡§Ö‡§™ ‡§ï‡§®‡•ç‡§´‡§∞‡•ç‡§Æ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>

        <div id="delivery-sec" class="app-sec hidden">
            <div class="card">
                <h3>üöö ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§î‡§∞ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü</h3>
                <div class="input-group">
                    <input type="tel" id="delMobile" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
                    <button type="button" class="btn-contact" onclick="getContact('delMobile')">üë§</button>
                </div>
                <label>‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏:</label>
                <select id="payStatus">
                    <option value="Paid">‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ (Paid)</option>
                    <option value="Pending">‡§¨‡§æ‡§ï‡•Ä ‡§π‡•à (Pending)</option>
                </select>
                <input type="number" id="amount" placeholder="‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø (‚Çπ)">
                <button class="btn btn-success" id="delBtn" onclick="confirmDelivery()">‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showSec('pickup-sec', this)">üß∫<span>‡§™‡§ø‡§ï‡§Ö‡§™</span></div>
        <div class="nav-item" onclick="showSec('delivery-sec', this)">üöö<span>‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä</span></div>
    </div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbw3DDCp3zNLllZvO0UEJXkmDjDUnXnycCPdfFYaCAohtoIcQ6VYhRLjgMhERr9Kbfxg/exec';
    let selectedItems = [];

    // ‡§ï‡•â‡§®‡•ç‡§ü‡•à‡§ï‡•ç‡§ü ‡§™‡§ø‡§ï‡§∞
    async function getContact(mobileId) {
        if (!('contacts' in navigator)) return alert("‡§ï‡•â‡§®‡•ç‡§ü‡•à‡§ï‡•ç‡§ü ‡§´‡•Ä‡§ö‡§∞ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§");
        try {
            const props = ['tel'];
            const contacts = await navigator.contacts.select(props, {multiple: false});
            if (contacts.length > 0) {
                let rawNum = contacts[0].tel[0].replace(/\D/g, '');
                document.getElementById(mobileId).value = rawNum.slice(-10);
            }
        } catch (err) { console.log(err); }
    }

    function showSec(id, btn) {
        document.querySelectorAll('.app-sec').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
    }

    const inventory = {
        men: ["‡§∂‡§∞‡•ç‡§ü", "‡§™‡•á‡§Ç‡§ü", "‡§ú‡•Ä‡§Ç‡§∏", "‡§ü‡•Ä-‡§∂‡§∞‡•ç‡§ü", "‡§∏‡•Ç‡§ü", "‡§ï‡•ã‡§ü", "‡§ï‡•Å‡§∞‡•ç‡§§‡§æ-‡§™‡§æ‡§Ø‡§ú‡§æ‡§Æ‡§æ"],
        women: ["‡§∏‡§æ‡•ú‡•Ä", "‡§∏‡•Ç‡§ü-‡§∏‡§≤‡§µ‡§æ‡§∞", "‡§ï‡•Å‡§∞‡•ç‡§§‡•Ä", "‡§≤‡§π‡§Ç‡§ó‡§æ", "‡§¶‡•Å‡§™‡§ü‡•ç‡§ü‡§æ", "‡§ó‡§æ‡§â‡§®"],
        winter: ["‡§ú‡•à‡§ï‡•á‡§ü", "‡§≠‡§æ‡§∞‡•Ä ‡§ï‡•ã‡§ü", "‡§∏‡•ç‡§µ‡•á‡§ü‡§∞", "‡§ï‡§æ‡§∞‡•ç‡§°‡§ø‡§ó‡§®", "‡§∂‡•â‡§≤", "‡§¨‡•ç‡§≤‡•á‡§ú‡§∞"],
        home: ["‡§ö‡§æ‡§¶‡§∞", "‡§ï‡§Ç‡§¨‡§≤", "‡§™‡§∞‡•ç‡§¶‡•á", "‡§§‡•å‡§≤‡§ø‡§Ø‡§æ", "‡§ó‡§≤‡•Ä‡§ö‡§æ"]
    };

    function loadItems(cat, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const sel = document.getElementById('itemSelect');
        sel.innerHTML = '';
        inventory[cat].forEach(i => { sel.innerHTML += `<option value="${i}">${i}</option>`; });
    }

    function addToInv() {
        const item = document.getElementById('itemSelect').value;
        const qty = document.getElementById('itemQty').value;
        const note = document.getElementById('itemNote').value;
        const service = document.getElementById('serviceType').value;
        if(!item || !qty) return alert("‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§≠‡§∞‡•á‡§Ç");
        const entry = `${item}(${qty} ‡§®‡§ó)-${service}[${note}]`;
        selectedItems.push(entry);
        document.getElementById('liveList').innerHTML += `<div>‚Ä¢ ${entry}</div>`;
        document.getElementById('itemQty').value = "";
    }

    // ‡§™‡§ø‡§ï‡§Ö‡§™ ‡§°‡•á‡§ü‡§æ ‡§≠‡•á‡§ú‡§®‡§æ
    function submitPickup() {
        const mobile = document.getElementById('pickMobile').value;
        const dbStr = selectedItems.join(", ");
        const btn = document.getElementById('pickBtn');
        if(!mobile || selectedItems.length === 0) return alert("‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§î‡§∞ ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§≠‡§∞‡•á‡§Ç");

        btn.innerText = "‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
        btn.disabled = true;

        // ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞: action=updateStatus ‡§Ø‡§æ action=addCustomer ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó (‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏ ‡§ï‡•á ‡§∏‡§æ‡§•)
        fetch(`${scriptURL}?action=updateStatus&mobile=${mobile}&status=‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç&details=${encodeURIComponent(dbStr)}`)
        .then(response => response.json())
        .then(data => {
            alert("‡§™‡§ø‡§ï‡§Ö‡§™ ‡§∏‡§´‡§≤! ‚úÖ");
            const waMsg = `*‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§∞‡•ç‡§∏* üß∫\n\n‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Ü‡§™‡§ï‡§æ ‡§™‡§ø‡§ï‡§Ö‡§™ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§\n‡§µ‡§ø‡§µ‡§∞‡§£: ${dbStr}\n\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!`;
            window.open(`https://wa.me/91${mobile}?text=${encodeURIComponent(waMsg)}`, '_blank');
            location.reload();
        })
        .catch(() => { alert("‡§∏‡§´‡§≤!"); location.reload(); });
    }

    // ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§î‡§∞ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§Ö‡§™‡§°‡•á‡§ü
    function confirmDelivery() {
        const mobile = document.getElementById('delMobile').value;
        const amt = document.getElementById('amount').value;
        const btn = document.getElementById('delBtn');
        if(!mobile || !amt) return alert("‡§™‡•Ç‡§∞‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");

        btn.innerText = "‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
        btn.disabled = true;

        fetch(`${scriptURL}?action=updateStatus&mobile=${mobile}&status=Delivered&amount=${amt}`)
        .then(response => response.json())
        .then(data => {
            alert("‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§∏‡§´‡§≤! ‚úÖ");
            location.reload();
        })
        .catch(() => { alert("‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü ‡§∏‡§´‡§≤!"); location.reload(); });
    }
</script>
</body>
</html>
