<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver App | PRATIKSHA</title>
    <link rel="manifest" href="manifest-driver.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --sun: #FF8C00; --dark: #001F3F; --green: #2E8B57; --bg: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-bottom: 70px; }
        .app-header { background: var(--dark); color: white; padding: 15px; text-align: center; border-radius: 0 0 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .app-logo { width: 70px; height: 70px; border-radius: 50%; background: white; padding: 5px; margin-bottom: 8px; border: 2px solid var(--sun); object-fit: contain; }
        .container { padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* рдЗрдирдкреБрдЯ рдФрд░ рдХреЙрдиреНрдЯреИрдХреНрдЯ рдмрдЯрди рдХрд╛ рддрд╛рд▓рдореЗрд▓ */
        .input-group { display: flex; gap: 8px; margin: 10px 0; }
        .input-group input { margin: 0; flex: 1; }
        .btn-contact { padding: 0 15px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-size: 1.2rem; transition: 0.3s; display: flex; align-items: center; }
        .btn-contact:active { background: #f0f0f0; transform: scale(0.95); }

        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 1rem; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--sun); color: white; }
        .btn-success { background: var(--green); color: white; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); border-top: 1px solid #eee; }
        .nav-item { border: none; background: none; color: #888; font-size: 0.8rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--sun); font-weight: bold; }
        .cat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
        .cat-btn { background: #f0f0f0; border: 1px solid #ddd; padding: 10px; border-radius: 8px; font-size: 0.75rem; font-weight: bold; cursor: pointer; }
        .cat-btn.active { background: var(--dark); color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="app-header">
        <img src="logo.png" alt="PRATIKSHA" class="app-logo">
        <h2 style="margin:0; font-size: 1.2rem;">рдкреНрд░рддреАрдХреНрд╖рд╛ рдбреНрд░рд╛рдЗрд╡рд░ рдРрдк</h2>
    </div>

    <div class="container">
        <div id="pickup-sec" class="app-sec">
            <div class="card">
                <h3>ЁЯз║ рдирдпрд╛ рдкрд┐рдХрдЕрдк</h3>
                <div class="input-group">
                    <input type="tel" id="pickMobile" placeholder="рдЧреНрд░рд╛рд╣рдХ рдХрд╛ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░">
                    <button type="button" class="btn-contact" onclick="getContact('pickMobile')" title="рдХреЙрдиреНрдЯреИрдХреНрдЯ рдЪреБрдиреЗрдВ">ЁЯСд</button>
                </div>
                
                <div class="cat-grid">
                    <button class="cat-btn" onclick="loadItems('men', this)">MEN</button>
                    <button class="cat-btn" onclick="loadItems('women', this)">WOMEN</button>
                    <button class="cat-btn" onclick="loadItems('winter', this)">WINTER (рдЧрд░реНрдо рдХрдкрдбрд╝реЗ)</button>
                    <button class="cat-btn" onclick="loadItems('home', this)">HOME (рдШрд░/рдЕрдиреНрдп)</button>
                </div>

                <select id="itemSelect"><option value="">рдХреИрдЯреЗрдЧрд░реА рдЪреБрдиреЗрдВ</option></select>

                <label style="font-size: 0.8rem; font-weight: bold;">рд╕реЗрд╡рд╛ рдЪреБрдиреЗрдВ:</label>
                <select id="serviceType">
                    <option value="рдбреНрд░рд╛рдИ рдХреНрд▓реАрди">тЬи рдбреНрд░рд╛рдИ рдХреНрд▓реАрди</option>
                    <option value="рд╕реНрдЯреАрдо рдкреНрд░реЗрд╕">ЁЯТи рд╕реНрдЯреАрдо рдкреНрд░реЗрд╕</option>
                    <option value="рд╕рд╛рдзрд╛рд░рдг рдкреНрд░реЗрд╕">ЁЯСФ рд╕рд╛рдзрд╛рд░рдг рдкреНрд░реЗрд╕</option>
                    <option value="рдзреБрд▓рд╛рдИ">ЁЯз╝ рдзреБрд▓рд╛рдИ</option>
                </select>

                <div style="display:flex; gap:10px;">
                    <input type="number" id="itemQty" placeholder="рд╕рдВрдЦреНрдпрд╛" style="flex:1;">
                    <select id="itemNote" style="flex:1;">
                        <option value="OK">OK</option>
                        <option value="рджрд╛рдЧ">рджрд╛рдЧ</option>
                        <option value="рдХрдЯрд╛">рдХрдЯрд╛</option>
                    </select>
                </div>

                <button onclick="addToInv()" style="background:#eee; border:1px solid #ccc; width:100%; padding:10px; border-radius:8px; cursor:pointer;">+ рд▓рд┐рд╕реНрдЯ рдореЗрдВ рдЬреЛреЬреЗрдВ</button>
                <div id="liveList" style="margin-top:15px; font-size:0.85rem; color:#555; background:#fffde7; padding:10px; border-radius:8px;"><b>рд▓рд┐рд╕реНрдЯ:</b></div>
                <button class="btn btn-primary" style="margin-top:15px;" onclick="submitPickup()">рдкрд┐рдХрдЕрдк рдХрдиреНрдлрд░реНрдо рдХрд░реЗрдВ</button>
            </div>
        </div>

        <div id="delivery-sec" class="app-sec hidden">
            <div class="card">
                <h3>ЁЯЪЪ рдбрд┐рд▓реАрд╡рд░реА рдФрд░ рдкреЗрдореЗрдВрдЯ</h3>
                <div class="input-group">
                    <input type="tel" id="delMobile" placeholder="рдЧреНрд░рд╛рд╣рдХ рдХрд╛ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░">
                    <button type="button" class="btn-contact" onclick="getContact('delMobile')" title="рдХреЙрдиреНрдЯреИрдХреНрдЯ рдЪреБрдиреЗрдВ">ЁЯСд</button>
                </div>
                <label>рдкреЗрдореЗрдВрдЯ рд╕реНрдЯреЗрдЯрд╕:</label>
                <select id="payStatus">
                    <option value="Paid">рднреБрдЧрддрд╛рди рдкреНрд░рд╛рдкреНрдд (Paid)</option>
                    <option value="Pending">рдмрд╛рдХреА рд╣реИ (Pending)</option>
                </select>
                <input type="number" id="amount" placeholder="рдХреБрд▓ рд░рд╛рд╢рд┐ (тВ╣)">
                <button class="btn btn-success" onclick="confirmDelivery()">рдбрд┐рд▓реАрд╡рд░реА рдкреВрд░реНрдг рдХрд░реЗрдВ</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="showSec('pickup-sec', this)">ЁЯз║<span>рдкрд┐рдХрдЕрдк</span></div>
        <div class="nav-item" onclick="showSec('delivery-sec', this)">ЁЯЪЪ<span>рдбрд┐рд▓реАрд╡рд░реА</span></div>
    </div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbw_-n2prkikRnlqWjK6hK1zEJLFtZyxT41aZKWZXFKvt_m-OoDWm0QAJ70845JmX5UQ3Q/exec';
    let selectedItems = [];

    // --- рдХреЙрдиреНрдЯреИрдХреНрдЯ рдкрд┐рдХрд░ рдЬрд╛рджреБрдИ рдлрдВрдХреНрд╢рди ---
    async function getContact(mobileId) {
        if (!('contacts' in navigator && 'ContactsManager' in window)) {
            return alert("рдпрд╣ рдлреАрдЪрд░ рдХреЗрд╡рд▓ Android Chrome рдФрд░ HTTPS рд▓рд┐рдВрдХ рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред");
        }
        try {
            const props = ['tel'];
            const contacts = await navigator.contacts.select(props, {multiple: false});
            if (contacts.length > 0 && contacts[0].tel.length > 0) {
                let rawNum = contacts[0].tel[0].replace(/\D/g, '');
                let cleanNum = rawNum.length > 10 ? rawNum.slice(-10) : rawNum;
                document.getElementById(mobileId).value = cleanNum;
            }
        } catch (err) {
            console.log("Error: " + err.message);
        }
    }

    function showSec(id, btn) {
        document.querySelectorAll('.app-sec').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        btn.classList.add('active');
    }

    const inventory = {
        men: ["рд╢рд░реНрдЯ", "рдкреЗрдВрдЯ", "рдЬреАрдВрд╕", "рдЯреА-рд╢рд░реНрдЯ", "рд╕реВрдЯ", "рдХреЛрдЯ", "рдХреБрд░реНрддрд╛-рдкрд╛рдпрдЬрд╛рдорд╛", "рд░реЗрдЧреБрд▓рд░ рдХрдкреЬреЗ", "рдЕрдиреНрдп"],
        women: ["рд╕рд╛реЬреА", "рд╕реВрдЯ-рд╕рд▓рд╡рд╛рд░", "рдХреБрд░реНрддреА", "рд▓рд╣рдВрдЧрд╛", "рджреБрдкрдЯреНрдЯрд╛", "рдЧрд╛рдЙрди", "рд░реЗрдЧреБрд▓рд░ рдХрдкреЬреЗ", "рдЕрдиреНрдп"],
        winter: ["рдЬреИрдХреЗрдЯ", "рдХреЛрдЯ (Heavy)", "рд╕реНрд╡реЗрдЯрд░", "рдХрд╛рд░реНрдбрд┐рдЧрди", "рд╢реЙрд▓", "рдмреНрд▓реЗрдЬрд░", "рдЗрдирд░рд╡реЗрдпрд░", "рдЕрдиреНрдп рдЧрд░реНрдо рдХрдкрдбрд╝реЗ"],
        home: ["рдЪрд╛рджрд░", "рдкрд┐рд▓реЛ рдХрд╡рд░", "рдХрдВрдмрд▓", "рдмреЬрд╛ рддреМрд▓рд┐рдпрд╛", "рдЫреЛрдЯрд╛ рддреМрд▓рд┐рдпрд╛", "рд░реБрдорд╛рд▓/рдиреИрдкрдХрд┐рди", "рдкрд░реНрджреЗ", "рдзреЛрддреА", "рдЧрд▓реАрдЪрд╛", "рдЕрдиреНрдп"]
    };

    function loadItems(cat, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const sel = document.getElementById('itemSelect');
        sel.innerHTML = '';
        inventory[cat].forEach(i => { sel.innerHTML += `<option value="${cat.toUpperCase()}: ${i}">${i}</option>`; });
    }

    function addToInv() {
        const item = document.getElementById('itemSelect').value;
        const qty = document.getElementById('itemQty').value;
        const note = document.getElementById('itemNote').value;
        const service = document.getElementById('serviceType').value;
        
        if(!item || !qty) return alert("рдЬрд╛рдирдХрд╛рд░реА рднрд░реЗрдВ");
        
        const entry = `${item} [${qty}] - ${service} (${note})`;
        selectedItems.push(entry);
        document.getElementById('liveList').innerHTML += `<div>тАв ${entry}</div>`;
        document.getElementById('itemQty').value = "";
    }

    function submitPickup() {
        const mobile = document.getElementById('pickMobile').value;
        const dbStr = selectedItems.join(", ");
        if(!mobile || selectedItems.length === 0) return alert("рдореЛрдмрд╛рдЗрд▓ рдФрд░ рд▓рд┐рд╕реНрдЯ рднрд░реЗрдВ");

        const btn = document.querySelector('button[onclick="submitPickup()"]');
        btn.innerText = "рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИ...";
        btn.disabled = true;

        fetch(`${scriptURL}?action=updatePickup&mobile=${mobile}&details=${encodeURIComponent(dbStr)}`)
        .then(response => response.text())
        .then(data => {
            if(data === "Success") {
                alert("рдкрд┐рдХрдЕрдк рд╕рдлрд▓! тЬЕ");
                const waMsg = `*рдкреНрд░рддреАрдХреНрд╖рд╛ рдбреНрд░рд╛рдИ рдХреНрд▓реАрдирд░реНрд╕* ЁЯз║тЬи\n\nрдирдорд╕реНрддреЗ,\nрдЖрдкрдХрд╛ рдкрд┐рдХрдЕрдк рд╕рдлрд▓ рд░рд╣рд╛ред\n\n*рд╡рд┐рд╡рд░рдг:* ${dbStr}\n\nрдзрдиреНрдпрд╡рд╛рдж! ЁЯЩП`;
                window.open(`https://wa.me/91${mobile}?text=${encodeURIComponent(waMsg)}`, '_blank');
                location.reload();
            } else {
                alert("рд╕рд░реНрд╡рд░ рдПрд░рд░ред");
                btn.innerText = "рдкрд┐рдХрдЕрдк рдХрдиреНрдлрд░реНрдо рдХрд░реЗрдВ";
                btn.disabled = false;
            }
        })
        .catch(() => {
            alert("рдиреЗрдЯрд╡рд░реНрдХ рдПрд░рд░!");
            btn.innerText = "рдкрд┐рдХрдЕрдк рдХрдиреНрдлрд░реНрдо рдХрд░реЗрдВ";
            btn.disabled = false;
        });
    }

    function confirmDelivery() {
        const mobile = document.getElementById('delMobile').value;
        const amt = document.getElementById('amount').value;
        const status = document.getElementById('payStatus').value;
        if(!mobile || !amt) return alert("рдкреВрд░реА рдЬрд╛рдирдХрд╛рд░реА рднрд░реЗрдВ");

        const btn = document.querySelector('button[onclick="confirmDelivery()"]');
        btn.innerText = "рдЕрдкрдбреЗрдЯ рд╣реЛ рд░рд╣рд╛ рд╣реИ...";
        btn.disabled = true;

        fetch(`${scriptURL}?action=updateStatus&mobile=${mobile}&status=Delivered&amount=${amt}`)
        .then(response => response.text())
        .then(data => {
            if(data === "Success") {
                alert("рдбрд┐рд▓реАрд╡рд░реА рдФрд░ рдкреЗрдореЗрдВрдЯ рд╕рдлрд▓! тЬЕ");
                location.reload();
            } else {
                alert("рдирдВрдмрд░ рдирд╣реАрдВ рдорд┐рд▓рд╛ред");
                btn.innerText = "рдбрд┐рд▓реАрд╡рд░реА рдкреВрд░реНрдг рдХрд░реЗрдВ";
                btn.disabled = false;
            }
        })
        .catch(() => {
            alert("рдиреЗрдЯрд╡рд░реНрдХ рд╕рдорд╕реНрдпрд╛ред");
            btn.innerText = "рдбрд┐рд▓реАрд╡рд░реА рдкреВрд░реНрдг рдХрд░реЗрдВ";
            btn.disabled = false;
        });
    }
</script>
</body>
</html>
