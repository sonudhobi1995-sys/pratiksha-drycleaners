<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin App | PRATIKSHA</title>
    
    <link rel="manifest" href="manifest-admin.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#001F3F">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --sun: #FF8C00; --dark: #001F3F; --green: #2E8B57; --bg: #f0f2f5; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-bottom: 20px; }
        
        .app-header { 
            background: linear-gradient(135deg, var(--dark) 0%, #003366 100%); 
            color: white; padding: 25px 15px; text-align: center; 
            border-radius: 0 0 30px 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
        }
        .app-logo {
            width: 80px; height: 80px; border-radius: 50%;
            background: white; padding: 5px; margin-bottom: 10px;
            border: 3px solid var(--sun); box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            object-fit: contain;
        }

        .container { padding: 20px; max-width: 500px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; border: 1px solid #e0e0e0; }
        
        h3 { color: var(--dark); margin-top: 0; display: flex; align-items: center; gap: 10px; font-size: 1.2rem; }
        label { font-size: 0.85rem; font-weight: 600; color: #555; margin-left: 5px; }

        input, select { width: 100%; padding: 14px; margin: 8px 0 18px 0; border-radius: 12px; border: 1.5px solid #ddd; box-sizing: border-box; font-size: 1rem; transition: 0.3s; }
        
        .input-group { display: flex; gap: 8px; margin: 8px 0 18px 0; }
        .input-group input { margin: 0; flex: 1; }
        .btn-contact { padding: 0 15px; border-radius: 12px; border: 1.5px solid #ddd; background: #fff; cursor: pointer; font-size: 1.2rem; transition: 0.3s; display: flex; align-items: center; }

        .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.3s; display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 15px; }
        .btn-status { background: var(--dark); color: white; }
        .btn-pickup { background: var(--green); color: white; }
        .btn-billing { background: var(--sun); color: white; box-shadow: 0 4px 10px rgba(255,140,0,0.3); }
        .btn:active { transform: scale(0.98); }
        .badge { background: var(--sun); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; text-transform: uppercase; }
    </style>
</head>
<body>

    <div class="app-header">
        <img src="logo.png" alt="PRATIKSHA" class="app-logo">
        <h2 style="margin:0; letter-spacing: 1px;">‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤</h2>
        <span class="badge">‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Æ‡•à‡§®‡•á‡§ú‡§∞</span>
    </div>

    <div class="container">
        <div class="card">
            <h3>üîÑ ‡§ï‡•ç‡§µ‡§ø‡§ï ‡§Ö‡§™‡§°‡•á‡§ü</h3>
            <label>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞:</label>
            <div class="input-group">
                <input type="tel" id="adminMobile" placeholder="98XXXXXXXX">
                <button type="button" class="btn-contact" onclick="getContact('adminMobile')" title="‡§ï‡•â‡§®‡•ç‡§ü‡•à‡§ï‡•ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç">
                    üë§
                </button>
            </div>
            
            <label>‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø:</label>
            <select id="adminStatus">
                <option value="‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç">‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§Æ‡•á‡§Ç</option>
                <option value="‡§ß‡•Å‡§≤‡§æ‡§à">‡§ß‡•Å‡§≤‡§æ‡§à</option>
                <option value="‡§Ü‡§Ø‡§∞‡§®‡§ø‡§Ç‡§ó">‡§Ü‡§Ø‡§∞‡§®‡§ø‡§Ç‡§ó</option>
                <option value="‡§∞‡•á‡§°‡•Ä ‡§ü‡•Ç ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä">‡§∞‡•á‡§°‡•Ä ‡§ü‡•Ç ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä</option>
                <option value="Delivered">‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ</option>
            </select>
            <button class="btn btn-status" id="updateBtn" onclick="updateStatusOnly()">
                ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§≠‡•á‡§ú‡•á‡§Ç
            </button>
        </div>

        <div class="card" style="border-left: 5px solid var(--sun);">
            <h3>üöÄ ‡§ï‡•ç‡§µ‡§ø‡§ï ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§®</h3>
            <button class="btn btn-pickup" onclick="window.location.href='driver-app.html'">
                üöö ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§ê‡§™ (Pickup)
            </button>
            <button class="btn btn-billing" onclick="window.location.href='billing.html'">
                üßæ ‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó ‡§ê‡§™ (Billing)
            </button>
        </div>
    </div>

<script>
    // ‡§Ü‡§™‡§ï‡§æ ‡§®‡§Ø‡§æ ‡§î‡§∞ ‡§∏‡§π‡•Ä v3.2 Final Link
    const scriptURL = 'https://script.google.com/macros/s/AKfycbw3DDCp3zN0TLllZvO0UEJXkmDjDUnXnycCPdfFYaCAohtoIcQ6VYhRLjgMhERr9Kbfxg/exec';

    async function getContact(mobileId) {
        if (!('contacts' in navigator)) return alert("‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§Ø‡§π ‡§´‡•Ä‡§ö‡§∞ ‡§ï‡•á‡§µ‡§≤ Android Chrome ‡§™‡§∞ ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§");
        try {
            const props = ['tel'];
            const contacts = await navigator.contacts.select(props, {multiple: false});
            if (contacts.length > 0) {
                let rawNum = contacts[0].tel[0].replace(/\D/g, '');
                document.getElementById(mobileId).value = rawNum.length > 10 ? rawNum.slice(-10) : rawNum;
            }
        } catch (err) { console.log(err); }
    }

    function updateStatusOnly() {
        const mobile = document.getElementById('adminMobile').value;
        const status = document.getElementById('adminStatus').value;
        const btn = document.getElementById('updateBtn');
        
        if(!mobile || mobile.length < 10) return alert("‡§∏‡§π‡•Ä ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç");

        btn.innerText = "‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
        btn.disabled = true;

        // v3.2 ‡§ï‡•Ä ‡§ï‡•ã‡§°‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞ ‡§ï‡•â‡§≤
        fetch(`${scriptURL}?action=updateStatus&mobile=${mobile}&status=${encodeURIComponent(status)}&amount=0&details=AdminUpdate`)
        .then(response => response.text())
        .then(data => {
            if(data === "Success") {
                alert("‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ! ‚úÖ");
                const waMsg = `*‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§∞‡•ç‡§∏* üß∫‚ú®\n\n‡§®‡§Æ‡§∏‡•ç‡§§‡•á,\n‡§Ü‡§™‡§ï‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡§æ ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§Ö‡§¨ *${status}* ‡§π‡•à‡•§\n\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè`;
                window.open(`https://wa.me/91${mobile}?text=${encodeURIComponent(waMsg)}`, '_blank');
                location.reload();
            } else {
                alert("‡§®‡§Ç‡§¨‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§");
                btn.innerText = "‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§≠‡•á‡§ú‡•á‡§Ç";
                btn.disabled = false;
            }
        })
        .catch(error => {
            alert("‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡•§");
            btn.innerText = "‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§≠‡•á‡§ú‡•á‡§Ç";
            btn.disabled = false;
        });
    }
</script>

</body>
</html>
